-- FIQQZR7 COPYMAP - VERSION KECIK (360x550)
-- Dengan progress bar & instance save

local player = game.Players.LocalPlayer
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

repeat task.wait() until player and player:FindFirstChild("PlayerGui")

local isMobile = not UserInputService.KeyboardEnabled
local hasClipboard = pcall(function() return setclipboard end)

local gui = Instance.new("ScreenGui")
gui.Name = "FIQQZR7COPYMAP"
gui.Parent = player.PlayerGui
gui.ResetOnSpawn = false
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
gui.DisplayOrder = 999

-- Main Container (kecik)
local container = Instance.new("Frame")
container.Size = UDim2.new(0, 380, 0, 570)  -- Dulu 420x650
container.Position = UDim2.new(0.5, -190, 0.5, -285)
container.BackgroundTransparency = 1
container.Active = true
container.Draggable = true
container.Parent = gui

-- Main Frame (kecik)
local main = Instance.new("Frame")
main.Size = UDim2.new(1, 0, 1, 0)
main.Position = UDim2.new(0, 0, 0, 0)
main.BackgroundColor3 = Color3.fromRGB(8, 12, 25)
main.BackgroundTransparency = 0.1
main.BorderColor3 = Color3.fromRGB(0, 150, 255)
main.BorderSizePixel = 2
main.ClipsDescendants = true
main.Parent = container

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 20)  -- Dulu 24
mainCorner.Parent = main

-- Glass Blur Effect
local blur = Instance.new("Frame")
blur.Size = UDim2.new(1, 0, 1, 0)
blur.BackgroundColor3 = Color3.fromRGB(10, 15, 30)
blur.BackgroundTransparency = 0.7
blur.BorderSizePixel = 0
blur.ZIndex = 0
blur.Parent = main

local blurCorner = Instance.new("UICorner")
blurCorner.CornerRadius = UDim.new(0, 20)
blurCorner.Parent = blur

-- Neon Glow Border (adjusted)
local glow = Instance.new("Frame")
glow.Size = UDim2.new(1, 8, 1, 8)  -- Dulu 10
glow.Position = UDim2.new(0, -4, 0, -4)
glow.BackgroundColor3 = Color3.fromRGB(0, 100, 255)
glow.BackgroundTransparency = 0.8
glow.BorderSizePixel = 0
glow.ZIndex = 0
glow.Parent = container

local glowCorner = Instance.new("UICorner")
glowCorner.CornerRadius = UDim.new(0, 22)
glowCorner.Parent = glow

-- Inner Glow (adjusted)
local innerGlow = Instance.new("Frame")
innerGlow.Size = UDim2.new(1, 4, 1, 4)  -- Dulu 6
innerGlow.Position = UDim2.new(0, -2, 0, -2)
innerGlow.BackgroundColor3 = Color3.fromRGB(0, 200, 255)
innerGlow.BackgroundTransparency = 0.7
innerGlow.BorderSizePixel = 0
innerGlow.ZIndex = 0
innerGlow.Parent = container

local innerGlowCorner = Instance.new("UICorner")
innerGlowCorner.CornerRadius = UDim.new(0, 21)
innerGlowCorner.Parent = innerGlow

-- Gradient Background
local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(15, 25, 45)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(10, 20, 40)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(5, 15, 35))
})
gradient.Rotation = 45
gradient.Parent = main

-- ==============================================
-- TITLE BAR (sama)
-- ==============================================
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, -20, 0, 60)  -- Dulu 70, sekarang 60
titleBar.Position = UDim2.new(0, 10, 0, 10)
titleBar.BackgroundColor3 = Color3.fromRGB(15, 20, 35)
titleBar.BackgroundTransparency = 0.2
titleBar.BorderColor3 = Color3.fromRGB(0, 150, 255)
titleBar.BorderSizePixel = 1
titleBar.Parent = main

local titleBarCorner = Instance.new("UICorner")
titleBarCorner.CornerRadius = UDim.new(0, 14)
titleBarCorner.Parent = titleBar

-- Icon
local icon = Instance.new("TextLabel")
icon.Size = UDim2.new(0, 40, 1, 0)  -- Dulu 45
icon.Position = UDim2.new(0, 8, 0, 0)  -- Dulu 10
icon.BackgroundTransparency = 1
icon.Text = "üó∫Ô∏è"
icon.TextColor3 = Color3.fromRGB(0, 200, 255)
icon.TextSize = 24  -- Dulu 28
icon.Font = Enum.Font.GothamBold
icon.Parent = titleBar

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(0.5, 0, 0.5, 0)
title.Position = UDim2.new(0, 55, 0, 8)  -- Adjusted
title.BackgroundTransparency = 1
title.Text = "FIQQZR7 COPYMAP"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextSize = 14  -- Dulu 16
title.Font = Enum.Font.GothamBold
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = titleBar

-- Subtitle
local subtitle = Instance.new("TextLabel")
subtitle.Size = UDim2.new(0.5, 0, 0.3, 0)
subtitle.Position = UDim2.new(0, 55, 0, 32)  -- Adjusted
subtitle.BackgroundTransparency = 1
subtitle.Text = "DEVELOPER FIQQZR7"
subtitle.TextColor3 = Color3.fromRGB(150, 200, 255)
subtitle.TextSize = 10  -- Dulu 11
subtitle.Font = Enum.Font.Gotham
subtitle.TextXAlignment = Enum.TextXAlignment.Left
subtitle.Parent = titleBar

-- Status indicator
local statusIndicator = Instance.new("Frame")
statusIndicator.Size = UDim2.new(0, 8, 0, 8)
statusIndicator.Position = UDim2.new(1, -25, 0.5, -4)
statusIndicator.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
statusIndicator.BorderSizePixel = 0
statusIndicator.Parent = titleBar

local statusCorner = Instance.new("UICorner")
statusCorner.CornerRadius = UDim.new(0, 4)
statusCorner.Parent = statusIndicator

-- ON/OFF Toggle
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0, 45, 0, 25)  -- Dulu 50x28
toggleBtn.Position = UDim2.new(1, -110, 0.5, -12)
toggleBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
toggleBtn.BorderColor3 = Color3.fromRGB(255, 255, 255)
toggleBtn.BorderSizePixel = 1
toggleBtn.Text = "ON"
toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 11  -- Dulu 12
toggleBtn.Parent = titleBar

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 7)
toggleCorner.Parent = toggleBtn

-- Close Button
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 25, 0, 25)  -- Dulu 30
closeBtn.Position = UDim2.new(1, -35, 0.5, -12)
closeBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
closeBtn.BorderColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.BorderSizePixel = 1
closeBtn.Text = "‚úï"
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 14  -- Dulu 16
closeBtn.Parent = titleBar

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 7)
closeCorner.Parent = closeBtn

-- ==============================================
-- CONTENT CONTAINER
-- ==============================================
local contentContainer = Instance.new("Frame")
contentContainer.Size = UDim2.new(1, -20, 1, -80)  -- Adjusted
contentContainer.Position = UDim2.new(0, 10, 0, 75)  -- Adjusted
contentContainer.BackgroundTransparency = 1
contentContainer.Parent = main

-- ==============================================
-- SCROLLING FRAME
-- ==============================================
local scrollingFrame = Instance.new("ScrollingFrame")
scrollingFrame.Size = UDim2.new(1, 0, 1, 0)
scrollingFrame.BackgroundTransparency = 1
scrollingFrame.BorderSizePixel = 0
scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 680)  -- Dulu 800
scrollingFrame.ScrollBarThickness = 4  -- Dulu 5
scrollingFrame.ScrollBarImageColor3 = Color3.fromRGB(0, 150, 255)
scrollingFrame.Parent = contentContainer

-- ==============================================
-- CARD HELPER FUNCTION (adjusted sizes)
-- ==============================================
local function createCard(title, icon, y, height)
    local card = Instance.new("Frame")
    card.Size = UDim2.new(0.95, 0, 0, height or 90)  -- Dulu 100
    card.Position = UDim2.new(0.025, 0, 0, y)
    card.BackgroundColor3 = Color3.fromRGB(12, 18, 30)
    card.BorderColor3 = Color3.fromRGB(0, 150, 255)
    card.BorderSizePixel = 1
    card.Parent = scrollingFrame
    
    local cardCorner = Instance.new("UICorner")
    cardCorner.CornerRadius = UDim.new(0, 14)  -- Dulu 16
    cardCorner.Parent = card
    
    local cardGradient = Instance.new("UIGradient")
    cardGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(15, 22, 38)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(10, 15, 28))
    })
    cardGradient.Rotation = 90
    cardGradient.Parent = card
    
    local cardIcon = Instance.new("TextLabel")
    cardIcon.Size = UDim2.new(0, 25, 0, 25)  -- Dulu 30
    cardIcon.Position = UDim2.new(0, 10, 0, 8)  -- Adjusted
    cardIcon.BackgroundTransparency = 1
    cardIcon.Text = icon
    cardIcon.TextColor3 = Color3.fromRGB(0, 200, 255)
    cardIcon.TextSize = 18  -- Dulu 20
    cardIcon.Font = Enum.Font.GothamBold
    cardIcon.Parent = card
    
    local cardTitle = Instance.new("TextLabel")
    cardTitle.Size = UDim2.new(1, -40, 0, 18)  -- Dulu 20
    cardTitle.Position = UDim2.new(0, 45, 0, 10)  -- Adjusted
    cardTitle.BackgroundTransparency = 1
    cardTitle.Text = title
    cardTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    cardTitle.TextSize = 12  -- Dulu 14
    cardTitle.Font = Enum.Font.GothamBold
    cardTitle.TextXAlignment = Enum.TextXAlignment.Left
    cardTitle.Parent = card
    
    return card
end

-- ==============================================
-- INFO CARD (adjusted)
-- ==============================================
local infoCard = createCard("DEVICE INFO", "üì±", 5, 70)  -- Dulu 80

local deviceIcon = Instance.new("TextLabel")
deviceIcon.Size = UDim2.new(0, 18, 0, 18)  -- Dulu 20
deviceIcon.Position = UDim2.new(0, 50, 0, 35)  -- Adjusted
deviceIcon.BackgroundTransparency = 1
deviceIcon.Text = isMobile and "üì±" or "üíª"
deviceIcon.TextColor3 = Color3.fromRGB(0, 200, 255)
deviceIcon.TextSize = 12  -- Dulu 14
deviceIcon.Font = Enum.Font.GothamBold
deviceIcon.Parent = infoCard

local deviceText = Instance.new("TextLabel")
deviceText.Size = UDim2.new(0.5, 0, 0, 18)
deviceText.Position = UDim2.new(0, 75, 0, 35)
deviceText.BackgroundTransparency = 1
deviceText.Text = isMobile and "MOBILE MODE" or "PC MODE"
deviceText.TextColor3 = Color3.fromRGB(255, 255, 255)
deviceText.TextSize = 10  -- Dulu 12
deviceText.Font = Enum.Font.Gotham
deviceText.TextXAlignment = Enum.TextXAlignment.Left
deviceText.Parent = infoCard

local clipboardIcon = Instance.new("TextLabel")
clipboardIcon.Size = UDim2.new(0, 18, 0, 18)
clipboardIcon.Position = UDim2.new(0.5, 15, 0, 35)  -- Adjusted
clipboardIcon.BackgroundTransparency = 1
clipboardIcon.Text = hasClipboard and "üìã" or "üíæ"
clipboardIcon.TextColor3 = hasClipboard and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 255, 0)
clipboardIcon.TextSize = 12
clipboardIcon.Font = Enum.Font.GothamBold
clipboardIcon.Parent = infoCard

local clipboardText = Instance.new("TextLabel")
clipboardText.Size = UDim2.new(0.4, 0, 0, 18)
clipboardText.Position = UDim2.new(0.5, 38, 0, 35)  -- Adjusted
clipboardText.BackgroundTransparency = 1
clipboardText.Text = hasClipboard and "Clipboard" or "Workspace"
clipboardText.TextColor3 = Color3.fromRGB(200, 200, 200)
clipboardText.TextSize = 10
clipboardText.Font = Enum.Font.Gotham
clipboardText.TextXAlignment = Enum.TextXAlignment.Left
clipboardText.Parent = infoCard

-- ==============================================
-- OPTIONS CARD (adjusted)
-- ==============================================
local optionsCard = createCard("SAVE OPTIONS", "‚öôÔ∏è", 80, 180)  -- Dulu 95,200

local options = {
    {name = "Terrain", icon = "üåç", default = true},
    {name = "BaseParts", icon = "üì¶", default = true},
    {name = "Models", icon = "üèóÔ∏è", default = true},
    {name = "Scripts", icon = "üìú", default = true},
    {name = "GUI", icon = "üñ•Ô∏è", default = true},
    {name = "Tools", icon = "üîß", default = true},
}

local checkboxStates = {}

local function createCheckbox(y, option)
    local row = Instance.new("Frame")
    row.Size = UDim2.new(1, -30, 0, 22)  -- Dulu 25
    row.Position = UDim2.new(0, 15, 0, y)
    row.BackgroundTransparency = 1
    row.Parent = optionsCard
    
    local check = Instance.new("TextButton")
    check.Size = UDim2.new(0, 16, 0, 16)  -- Dulu 18
    check.Position = UDim2.new(0, 0, 0.5, -8)
    check.BackgroundColor3 = option.default and Color3.fromRGB(0, 150, 255) or Color3.fromRGB(50, 50, 50)
    check.BorderColor3 = Color3.fromRGB(0, 150, 255)
    check.BorderSizePixel = 1
    check.Text = option.default and "‚úì" or ""
    check.TextColor3 = Color3.fromRGB(255, 255, 255)
    check.TextSize = 10  -- Dulu 12
    check.Font = Enum.Font.GothamBold
    check.Parent = row
    
    local checkCorner = Instance.new("UICorner")
    checkCorner.CornerRadius = UDim.new(0, 3)
    checkCorner.Parent = check
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -20, 1, 0)
    label.Position = UDim2.new(0, 20, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = option.icon .. "  " .. option.name
    label.TextColor3 = Color3.fromRGB(220, 220, 240)
    label.TextSize = 11  -- Dulu 12
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = row
    
    local state = option.default
    check.MouseButton1Click:Connect(function()
        state = not state
        check.BackgroundColor3 = state and Color3.fromRGB(0, 150, 255) or Color3.fromRGB(50, 50, 50)
        check.Text = state and "‚úì" or ""
    end)
    
    table.insert(checkboxStates, function() return state end)
end

for i, opt in ipairs(options) do
    createCheckbox(30 + (i-1) * 24, opt)  -- Adjusted spacing
end

-- ==============================================
-- FILENAME CARD
-- ==============================================
local nameCard = createCard("FILENAME", "üìÅ", 265, 70)  -- Dulu 305,80

local nameBg = Instance.new("Frame")
nameBg.Size = UDim2.new(0.9, 0, 0, 30)  -- Dulu 35
nameBg.Position = UDim2.new(0.05, 0, 0, 30)  -- Adjusted
nameBg.BackgroundColor3 = Color3.fromRGB(20, 25, 38)
nameBg.BorderColor3 = Color3.fromRGB(0, 150, 255)
nameBg.BorderSizePixel = 1
nameBg.Parent = nameCard

local nameBgCorner = Instance.new("UICorner")
nameBgCorner.CornerRadius = UDim.new(0, 7)
nameBgCorner.Parent = nameBg

local nameInput = Instance.new("TextBox")
nameInput.Size = UDim2.new(1, -10, 1, 0)
nameInput.Position = UDim2.new(0, 5, 0, 0)
nameInput.BackgroundTransparency = 1
nameInput.TextColor3 = Color3.fromRGB(255, 255, 255)
nameInput.PlaceholderColor3 = Color3.fromRGB(100, 120, 150)
nameInput.PlaceholderText = "FIQQZR7MAP"
nameInput.Text = "FIQQZR7MAP"
nameInput.Font = Enum.Font.Gotham
nameInput.TextSize = 12  -- Dulu 14
nameInput.ClearTextOnFocus = false
nameInput.Parent = nameBg

-- ==============================================
-- LOCATION CARD
-- ==============================================
local locationCard = createCard("SAVE LOCATION", "üìÇ", 340, 60)  -- Dulu 395,70

local locationText = Instance.new("TextLabel")
locationText.Size = UDim2.new(1, -30, 0, 18)
locationText.Position = UDim2.new(0, 35, 0, 30)  -- Adjusted
locationText.BackgroundTransparency = 1
locationText.Text = "workspace.FIQQZR7_Saves"
locationText.TextColor3 = Color3.fromRGB(0, 255, 200)
locationText.TextSize = 10  -- Dulu 12
locationText.Font = Enum.Font.Code
locationText.TextXAlignment = Enum.TextXAlignment.Left
locationText.Parent = locationCard

-- ==============================================
-- STATS CARD
-- ==============================================
local statsCard = createCard("MAP STATS", "üìä", 405, 80)  -- Dulu 475,90

local partCount = Instance.new("TextLabel")
partCount.Size = UDim2.new(0.5, 0, 0, 16)
partCount.Position = UDim2.new(0, 35, 0, 30)  -- Adjusted
partCount.BackgroundTransparency = 1
partCount.Text = "üì¶ Parts: 0"
partCount.TextColor3 = Color3.fromRGB(200, 200, 200)
partCount.TextSize = 10  -- Dulu 11
partCount.Font = Enum.Font.Gotham
partCount.TextXAlignment = Enum.TextXAlignment.Left
partCount.Parent = statsCard

local scriptCount = Instance.new("TextLabel")
scriptCount.Size = UDim2.new(0.5, 0, 0, 16)
scriptCount.Position = UDim2.new(0.5, 0, 0, 30)
scriptCount.BackgroundTransparency = 1
scriptCount.Text = "üìú Scripts: 0"
scriptCount.TextColor3 = Color3.fromRGB(200, 200, 200)
scriptCount.TextSize = 10
scriptCount.Font = Enum.Font.Gotham
scriptCount.TextXAlignment = Enum.TextXAlignment.Left
scriptCount.Parent = statsCard

local terrainInfo = Instance.new("TextLabel")
terrainInfo.Size = UDim2.new(0.5, 0, 0, 16)
terrainInfo.Position = UDim2.new(0, 35, 0, 48)  -- Adjusted
terrainInfo.BackgroundTransparency = 1
terrainInfo.Text = "üåç Terrain: Yes"
terrainInfo.TextColor3 = Color3.fromRGB(200, 200, 200)
terrainInfo.TextSize = 10
terrainInfo.Font = Enum.Font.Gotham
terrainInfo.TextXAlignment = Enum.TextXAlignment.Left
terrainInfo.Parent = statsCard

local guiCount = Instance.new("TextLabel")
guiCount.Size = UDim2.new(0.5, 0, 0, 16)
guiCount.Position = UDim2.new(0.5, 0, 0, 48)
guiCount.BackgroundTransparency = 1
guiCount.Text = "üñ•Ô∏è GUI: 0"
guiCount.TextColor3 = Color3.fromRGB(200, 200, 200)
guiCount.TextSize = 10
guiCount.Font = Enum.Font.Gotham
guiCount.TextXAlignment = Enum.TextXAlignment.Left
guiCount.Parent = statsCard

-- ==============================================
-- PROGRESS CARD
-- ==============================================
local progressCard = createCard("SAVE PROGRESS", "‚è≥", 490, 60)  -- Dulu 575,70

local progressText = Instance.new("TextLabel")
progressText.Size = UDim2.new(0.7, 0, 0, 16)
progressText.Position = UDim2.new(0, 35, 0, 18)  -- Adjusted
progressText.BackgroundTransparency = 1
progressText.Text = "Ready to save"
progressText.TextColor3 = Color3.fromRGB(200, 200, 200)
progressText.TextSize = 10
progressText.Font = Enum.Font.Gotham
progressText.TextXAlignment = Enum.TextXAlignment.Left
progressText.Parent = progressCard

local progressBarBg = Instance.new("Frame")
progressBarBg.Size = UDim2.new(0.75, 0, 0, 8)  -- Dulu 0.8,10
progressBarBg.Position = UDim2.new(0.1, 0, 0, 38)
progressBarBg.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
progressBarBg.BorderColor3 = Color3.fromRGB(0, 150, 255)
progressBarBg.BorderSizePixel = 1
progressBarBg.Parent = progressCard

local progressBarBgCorner = Instance.new("UICorner")
progressBarBgCorner.CornerRadius = UDim.new(0, 4)
progressBarBgCorner.Parent = progressBarBg

local progressBar = Instance.new("Frame")
progressBar.Size = UDim2.new(0, 0, 1, 0)
progressBar.BackgroundColor3 = Color3.fromRGB(0, 200, 255)
progressBar.BorderSizePixel = 0
progressBar.Parent = progressBarBg

local progressBarCorner = Instance.new("UICorner")
progressBarCorner.CornerRadius = UDim.new(0, 4)
progressBarCorner.Parent = progressBar

local progressPercent = Instance.new("TextLabel")
progressPercent.Size = UDim2.new(0.1, 0, 0, 16)
progressPercent.Position = UDim2.new(0.85, 0, 0, 37)
progressPercent.BackgroundTransparency = 1
progressPercent.Text = "0%"
progressPercent.TextColor3 = Color3.fromRGB(0, 200, 255)
progressPercent.TextSize = 9
progressPercent.Font = Enum.Font.GothamBold
progressPercent.TextXAlignment = Enum.TextXAlignment.Right
progressPercent.Parent = progressCard

-- ==============================================
-- STATUS CARD
-- ==============================================
local statusCard = createCard("STATUS", "üü¢", 555, 60)  -- Dulu 655,70

local statusText = Instance.new("TextLabel")
statusText.Size = UDim2.new(0.7, 0, 0, 18)
statusText.Position = UDim2.new(0, 35, 0, 18)
statusText.BackgroundTransparency = 1
statusText.Text = "READY"
statusText.TextColor3 = Color3.fromRGB(0, 255, 0)
statusText.TextSize = 12  -- Dulu 14
statusText.Font = Enum.Font.GothamBold
statusText.TextXAlignment = Enum.TextXAlignment.Left
statusText.Parent = statusCard

local lastSave = Instance.new("TextLabel")
lastSave.Size = UDim2.new(0.7, 0, 0, 14)
lastSave.Position = UDim2.new(0, 35, 0, 38)
lastSave.BackgroundTransparency = 1
lastSave.Text = "Last save: -"
lastSave.TextColor3 = Color3.fromRGB(150, 150, 150)
lastSave.TextSize = 9  -- Dulu 10
lastSave.Font = Enum.Font.Gotham
lastSave.TextXAlignment = Enum.TextXAlignment.Left
lastSave.Parent = statusCard

-- ==============================================
-- SAVE BUTTON
-- ==============================================
local saveBtn = Instance.new("TextButton")
saveBtn.Size = UDim2.new(0.9, 0, 0, 45)  -- Dulu 50
saveBtn.Position = UDim2.new(0.05, 0, 0, 620)  -- Adjusted
saveBtn.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
saveBtn.BorderColor3 = Color3.fromRGB(0, 150, 255)
saveBtn.BorderSizePixel = 2
saveBtn.Text = "üíæ SAVE MAP"
saveBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
saveBtn.Font = Enum.Font.GothamBold
saveBtn.TextSize = 16  -- Dulu 18
saveBtn.Parent = scrollingFrame

local saveCorner = Instance.new("UICorner")
saveCorner.CornerRadius = UDim.new(0, 10)  -- Dulu 12
saveCorner.Parent = saveBtn

-- Update canvas size
scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 680)

-- ==============================================
-- ON/OFF TOGGLE FUNCTION
-- ==============================================
local uiVisible = true
toggleBtn.MouseButton1Click:Connect(function()
    uiVisible = not uiVisible
    
    if uiVisible then
        TweenService:Create(container, TweenInfo.new(0.4, Enum.EasingStyle.Quad), {
            Size = UDim2.new(0, 380, 0, 570)
        }):Play()
        task.wait(0.1)
        contentContainer.Visible = true
        toggleBtn.Text = "ON"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
        statusIndicator.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
    else
        contentContainer.Visible = false
        TweenService:Create(container, TweenInfo.new(0.4, Enum.EasingStyle.Quad), {
            Size = UDim2.new(0, 380, 0, 70)
        }):Play()
        toggleBtn.Text = "OFF"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
        statusIndicator.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    end
end)

closeBtn.MouseButton1Click:Connect(function()
    gui:Destroy()
end)

-- Insert key toggle
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.Insert then
        container.Visible = not container.Visible
    end
end)

-- ==============================================
-- MAP SAVING FUNCTIONS (sama)
-- ==============================================

local function countWorkspace()
    local parts = 0
    local scripts = 0
    local guis = 0
    
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") and not obj:IsA("Terrain") then
            parts = parts + 1
        elseif obj:IsA("LocalScript") or obj:IsA("Script") then
            scripts = scripts + 1
        elseif obj:IsA("ScreenGui") or obj:IsA("SurfaceGui") then
            guis = guis + 1
        end
    end
    
    partCount.Text = "üì¶ Parts: " .. parts
    scriptCount.Text = "üìú Scripts: " .. scripts
    guiCount.Text = "üñ•Ô∏è GUI: " .. guis
end

-- Update progress function
local function updateProgress(percent, message)
    progressBar.Size = UDim2.new(percent/100, 0, 1, 0)
    progressPercent.Text = math.floor(percent) .. "%"
    
    if message then
        progressText.Text = message
    end
    
    statusText.Text = "SAVING..."
    statusText.TextColor3 = Color3.fromRGB(255, 255, 0)
    
    task.wait()
end

-- Clone instance dengan semua properties
local function cloneInstance(instance, parent)
    local clone = instance:Clone()
    clone.Parent = parent
    return clone
end

-- Save map dengan progress
local function saveMap()
    updateProgress(0, "Preparing to save...")
    
    -- Get selected options
    local saveTerrain = checkboxStates[1]()
    local saveParts = checkboxStates[2]()
    local saveModels = checkboxStates[3]()
    local saveScripts = checkboxStates[4]()
    local saveGUI = checkboxStates[5]()
    local saveTools = checkboxStates[6]()
    
    -- Create save folder in workspace
    local saveFolder = workspace:FindFirstChild("FIQQZR7_Saves")
    if not saveFolder then
        saveFolder = Instance.new("Folder")
        saveFolder.Name = "FIQQZR7_Saves"
        saveFolder.Parent = workspace
    end
    
    -- Create timestamp folder
    local timestamp = os.date("%Y-%m-%d_%H-%M-%S")
    local mapName = nameInput.Text ~= "" and nameInput.Text or "FIQQZR7_Map"
    local saveName = mapName .. "_" .. timestamp
    
    local mapFolder = Instance.new("Folder")
    mapFolder.Name = saveName
    mapFolder.Parent = saveFolder
    
    updateProgress(5, "Created save folder")
    
    -- Count total items for progress
    local totalItems = 0
    local itemsToSave = {}
    
    -- Terrain (count as 1 item)
    if saveTerrain then
        totalItems = totalItems + 1
    end
    
    -- Collect all items
    if saveParts then
        for _, obj in ipairs(workspace:GetDescendants()) do
            if obj:IsA("BasePart") and not obj:IsA("Terrain") then
                table.insert(itemsToSave, obj)
                totalItems = totalItems + 1
            end
        end
    end
    
    if saveModels then
        for _, obj in ipairs(workspace:GetChildren()) do
            if obj:IsA("Model") then
                table.insert(itemsToSave, obj)
                totalItems = totalItems + 1
            end
        end
    end
    
    if saveScripts then
        for _, obj in ipairs(workspace:GetDescendants()) do
            if obj:IsA("LocalScript") or obj:IsA("Script") then
                table.insert(itemsToSave, obj)
                totalItems = totalItems + 1
            end
        end
    end
    
    if saveGUI then
        for _, obj in ipairs(player.PlayerGui:GetChildren()) do
            if obj:IsA("ScreenGui") then
                table.insert(itemsToSave, obj)
                totalItems = totalItems + 1
            end
        end
    end
    
    if saveTools then
        for _, obj in ipairs(workspace:GetDescendants()) do
            if obj:IsA("Tool") then
                table.insert(itemsToSave, obj)
                totalItems = totalItems + 1
            end
        end
    end
    
    updateProgress(10, "Collected " .. totalItems .. " items")
    
    -- Save Terrain
    if saveTerrain then
        updateProgress(15, "Saving Terrain...")
        local terrainFolder = Instance.new("Folder")
        terrainFolder.Name = "Terrain"
        terrainFolder.Parent = mapFolder
        
        local terrain = workspace.Terrain
        if terrain then
            local terrainClone = terrain:Clone()
            terrainClone.Parent = terrainFolder
        end
        
        terrainInfo.Text = "üåç Terrain: Yes"
    else
        terrainInfo.Text = "üåç Terrain: No"
    end
    
    -- Save all items with progress
    local savedCount = 0
    local startProgress = 20
    local progressPerItem = totalItems > 0 and 60 / totalItems or 0
    
    for _, obj in ipairs(itemsToSave) do
        savedCount = savedCount + 1
        local percent = startProgress + (savedCount * progressPerItem)
        
        local objType = obj.ClassName
        if obj:IsA("BasePart") then
            objType = "Part"
        elseif obj:IsA("Model") then
            objType = "Model"
        elseif obj:IsA("LocalScript") or obj:IsA("Script") then
            objType = "Script"
        elseif obj:IsA("ScreenGui") then
            objType = "GUI"
        elseif obj:IsA("Tool") then
            objType = "Tool"
        end
        
        updateProgress(percent, "Saving " .. objType .. ": " .. obj.Name)
        
        local clone = obj:Clone()
        
        if obj:IsA("ScreenGui") then
            local guiFolder = mapFolder:FindFirstChild("GUIs")
            if not guiFolder then
                guiFolder = Instance.new("Folder")
                guiFolder.Name = "GUIs"
                guiFolder.Parent = mapFolder
            end
            clone.Parent = guiFolder
        else
            clone.Parent = mapFolder
        end
        
        if savedCount % 10 == 0 then
            task.wait()
        end
    end
    
    updateProgress(85, "Finalizing...")
    
    -- Create info file
    local infoFile = Instance.new("StringValue")
    infoFile.Name = "SaveInfo"
    infoFile.Value = string.format([[Map Save: %s
Date: %s
Items Saved: %d
Terrain: %s
Parts: %s
Models: %s
Scripts: %s
GUI: %s
Tools: %s
Executor: %s]], 
        mapName,
        os.date("%Y-%m-%d %H:%M:%S"),
        savedCount,
        saveTerrain and "Yes" or "No",
        saveParts and "Yes" or "No",
        saveModels and "Yes" or "No",
        saveScripts and "Yes" or "No",
        saveGUI and "Yes" or "No",
        saveTools and "Yes" or "No",
        isMobile and "Mobile" or "PC"
    )
    infoFile.Parent = mapFolder
    
    updateProgress(95, "Saving metadata...")
    
    if hasClipboard then
        pcall(function()
            setclipboard("FIQQZR7SAVEMAP" .. saveName)
        end)
    end
    
    updateProgress(100, "Save complete!")
    
    statusText.Text = "SAVED!"
    statusText.TextColor3 = Color3.fromRGB(0, 255, 0)
    lastSave.Text = "Last save: " .. os.date("%H:%M:%S")
    
    print("‚úÖ MAP SAVED: " .. saveName)
    print("üìÅ Location: workspace.FIQQZR7_Saves." .. saveName)
    print("üì¶ Items saved: " .. savedCount)
    
    task.wait(2)
    
    progressBar.Size = UDim2.new(0, 0, 1, 0)
    progressPercent.Text = "0%"
    progressText.Text = "Ready to save"
    statusText.Text = "READY"
end

-- Update counts periodically
task.spawn(function()
    while true do
        countWorkspace()
        task.wait(2)
    end
end)

saveBtn.MouseButton1Click:Connect(saveMap)

-- Initial count
task.wait(0.5)
countWorkspace()

print("‚úÖ FIQQZR7 MAP SAVER - VERSION KECIK (360x550)")
print("üó∫Ô∏è Saves Terrain, Parts, Models, Scripts, GUI, Tools")
print("üìÅ Output: workspace.FIQQZR7_Saves")
print("‚è≥ Progress bar menunjukkan status saving")
print("üìè UI dikecilkan untuk portable use")
